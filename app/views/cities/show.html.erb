<% country_object = ISO3166::Country.find_country_by_name(@city.country.name) %>

<% dic = JSON.parse(HTTParty.get('http://api.openweathermap.org/data/2.5/weather?q=' + 
                                    @city.name + ',' + 
                                    country_object.alpha2 + '&units=metric&appid=' + 
                                    ENV["OPENWEATHER_API_KEY"]).to_json)%>

<% forecast_dic = JSON.parse(HTTParty.get('http://api.openweathermap.org/data/2.5/forecast?q=' + 
                                            @city.name + ',' + 
                                            country_object.alpha2 + '&cnt=6&units=metric&appid=' + ENV["OPENWEATHER_FORECAST_API_KEY"]).to_json)%>

<%= forecast_dic['list'][0]%>

<div class="row align-items-center flex-column">
    <h1 class="display-1"><%= @city.name %></h1>
    <h6> <%= link_to @city.country.name, country_path(@city.country) %> </h6>
</div>



<%= link_to save_city_path(@city), class: "save", method: :put do %>  
<%if current_user.find_saved_items.include?(@city)%>
<i class="fas fa-star"></i>
<%else%>
<i class="far fa-star"></i>
<%end%>
<%end%>



<div class="row">
    <p class="lead"><%= @city.description %></p>
</div>

<div class="row">
    <div class="col-sm-12 justify-content-center">
        <div class="show-image">
            <%= image_tag @city.image.url, alt: @city.name, class: "h-100 w-100" %>        
        </div>        
    </div>
</div>

<% if dic %>

    <br>

    <div class="row flex-column align-items-center">

        <h2>Current weather: <%= dic['weather'][0]['main']%></h2>
        <h2>Description: <%= dic['weather'][0]['description']%></h2>
            
        <%= image_tag("http://openweathermap.org/img/w/#{dic['weather'][0]['icon']}.png", :size => "100x100") %>

    </div>

    <br>

    <div class="row">
        <div class="col-md-1">
            <h2>Day: </h2>
            <h2>Min: </h2>
            <h2>Max: </h2>
        </div>

        <div class="col-md-2">
            <h2><%= next_five_days[0] %></h2>
            <h2><%= forecast_dic['list'][1]['main']['temp_min']%></h2>
            <h2><%= forecast_dic['list'][1]['main']['temp_max']%></h2>
            <%= image_tag("http://openweathermap.org/img/w/#{forecast_dic['list'][1]['weather'][0]['icon']}.png", :size => "100x100") %>
        </div>   

        <div class="col-md-2">
            <h2><%= next_five_days[1] %></h2>
            <h2><%= forecast_dic['list'][2]['main']['temp_min']%></h2>
            <h2><%= forecast_dic['list'][2]['main']['temp_max']%></h2>
            <%= image_tag("http://openweathermap.org/img/w/#{forecast_dic['list'][2]['weather'][0]['icon']}.png", :size => "100x100") %>
        </div>   

        <div class="col-md-2">
            <h2><%= next_five_days[2] %></h2>
            <h2><%= forecast_dic['list'][3]['main']['temp_min']%></h2>
            <h2><%= forecast_dic['list'][3]['main']['temp_max']%></h2>
            <%= image_tag("http://openweathermap.org/img/w/#{forecast_dic['list'][3]['weather'][0]['icon']}.png", :size => "100x100") %>
        </div>    

        <div class="col-md-2">
            <h2><%= next_five_days[3] %></h2>
            <h2><%= forecast_dic['list'][4]['main']['temp_min']%></h2>
            <h2><%= forecast_dic['list'][4]['main']['temp_max']%></h2>
            <%= image_tag("http://openweathermap.org/img/w/#{forecast_dic['list'][4]['weather'][0]['icon']}.png", :size => "100x100") %>
        </div>     

        <div class="col-md-2">
            <h2><%= next_five_days[4] %></h2>
            <h2><%= forecast_dic['list'][5]['main']['temp_min']%></h2>
            <h2><%= forecast_dic['list'][5]['main']['temp_max']%></h2>
            <%= image_tag("http://openweathermap.org/img/w/#{forecast_dic['list'][5]['weather'][0]['icon']}.png", :size => "100x100") %>
        </div>   

        <div class="col-md-1"></div>        
    </div>

<% end %>

<div class="row justify-content-center">
    <h2>Browse <%= @city.name %></h2>
</div>

<div class="row">
    <div class="col-md-4">
        <%= link_to '<i class="fas fa-hotel"></i> Hotels'.html_safe, city_hotels_path(@city), class: "btn activity-button" %>
    </div>        
    <div class="col-md-4">
        <%= link_to '<i class="fas fa-shoe-prints"></i> Citywalks'.html_safe, city_citywalks_path(@city), class: "btn activity-button" %>
    </div>        
    <div class="col-md-4">
        <%= link_to '<i class="fas fa-utensils"></i> Restaurants'.html_safe, city_restaurants_path(@city), class: "btn activity-button" %>
    </div>        
</div>

<hr>

<div class="row flex-column align-items-center">
    <h2>Book hotels, tours and attractions</h2>
    <p>Save time by booking in advance</p>
</div>

<div class="row justify-content-center">
    <h3 class="text-muted">Hotels</h3>
</div>

<div class="row">
    <%= render(@city.hotels.limit(3)) %>
</div>

<hr>

<%= link_to "Add Hotel", new_city_hotel_path(@city), class:"btn btn-primary"  %>

<div class="row justify-content-center">
    <h3 class="text-muted">Citywalks</h3>
</div>

<div class="row">
    <%= render(@city.citywalks.limit(3)) %>
</div>

<hr>

<%= link_to "Add Citywalk", new_city_citywalk_path(@city), class:"btn btn-primary"  %>

<div class="row justify-content-center">
    <h3 class="text-muted">Restaurants</h3>
</div>

<div class="row">
    <%= render(@city.restaurants.limit(3)) %>
</div>

<hr>

<%= link_to "Add restaurant", new_city_restaurant_path(@city), class:"btn btn-primary"  %>
